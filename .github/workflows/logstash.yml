name: Logstash Docker Image CI

on:
  push:
  pull_request:

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
    
    # Check if directory exists - needed because main branch doesn't contain Dockerfiles
    # (see README.md for branch model documentation)
    - name: Check if logstash directory exists
      id: check_dir
      run: |
        if [ ! -d "logstash" ]; then
          echo "exists=false" >> $GITHUB_OUTPUT
          echo "Directory logstash does not exist, skipping build"
        else
          echo "exists=true" >> $GITHUB_OUTPUT
        fi
    
    - name: Build the Logstash Docker image
      if: steps.check_dir.outputs.exists == 'true'
      run: docker build logstash

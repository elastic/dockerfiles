name: Elasticsearch Docker Image CI

on:
  push:
    branches-ignore: ['main']
  pull_request:

jobs:

  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
    
    - name: Check if elasticsearch directory exists
      id: check_dir
      run: |
        if [ ! -d "elasticsearch" ]; then
          echo "exists=false" >> $GITHUB_OUTPUT
          echo "Directory elasticsearch does not exist, skipping build"
        else
          echo "exists=true" >> $GITHUB_OUTPUT
        fi
    
    - name: Build the Elasticsearch Docker image
      if: steps.check_dir.outputs.exists == 'true'
      run: docker build elasticsearch
